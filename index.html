<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>AneuFiler</title>
  <script src="node_modules/mdui/dist/js/mdui.min.js"></script>
  <link rel="stylesheet" href="node_modules/mdui/dist/css/mdui.min.css" />
  <script type="text/javascript">
    function onload() { }
    function sub() {
      var resp = document.getElementById("response");
      var file = window.uploadFile;
      var xhr = new XMLHttpRequest();
      if (!window.fileMeta || !window.uploadFile) {
        resp.innerHTML = "ERROR";
        return;
      }
      xhr.open("POST", "/api/upload?filename=" + window.fileMeta.name, false);
      xhr.setRequestHeader("Content-Type", window.fileMeta.type);
      xhr.onreadystatechange = function () {
        if (xhr.readyState == 1 || xhr.readyState == 3) {
          resp.innerHTML = "Processing";
        } else if (xhr.readyState == 4) {
          resp.innerHTML = "End: ";
          if (xhr.status === 200) resp.innerHTML += "Success";
          else if (500 <= xhr.status < 600) resp.innerHTML += "Server Error";
          else if (400 <= xhr.status < 500) resp.innerHTML += "Client Error";
          else if (300 <= xhr.status < 400) resp.innerHTML += "Redirect Status";
          else if (100 <= xhr.status < 200) resp.innerHTML += "Informational Status";
          else resp.innerHTML += "Invalid Error";
        }
      };
      document.getElementById("the-file").value = "";
      xhr.send(file);
    }
    function deal() {
      var resp = document.getElementById("response");
      var file = window.uploadFile;
      var xhr = new XMLHttpRequest();
      if (!window.fileMeta || !window.uploadFile) {
        resp.innerHTML = "ERROR";
        return;
      }
      xhr.open("POST", "/api/uploadcat?filename=" + window.fileMeta.name, false);
      xhr.setRequestHeader("Content-Type", window.fileMeta.type);
      xhr.onreadystatechange = function () {
        if (xhr.readyState == 1 || xhr.readyState == 3) {
          resp.innerHTML = "Processing";
        } else if (xhr.readyState == 4) {
          resp.innerHTML = "End: ";
          if (xhr.status === 200) resp.innerHTML += "Success";
          else if (500 <= xhr.status < 600) resp.innerHTML += "Server Error";
          else if (400 <= xhr.status < 500) resp.innerHTML += "Client Error";
          else if (300 <= xhr.status < 400) resp.innerHTML += "Redirect Status";
          else if (100 <= xhr.status < 200) resp.innerHTML += "Informational Status";
          else resp.innerHTML += "Invalid Error";
        }
      };
      xhr.send(file);
    }
  </script>
</head>

<body onload="onload()" class="mdui-theme-primary-indigo mdui-bottom-nav-fixed">
  <div class="mdui-tab mdui-tab-centered mdui-tab-full-width" mdui-tab>
    <a href="#tab1" class="mdui-ripple mdui-tab-active" onmousedown="mOver1(this)"><i id="tab1_icon"
        class="mdui-icon material-icons">&#xe24d;</i></a>
    <a href="#tab2" class="mdui-ripple" onmousedown="mOver2(this)"><i id="tab2_icon"
        class="mdui-icon material-icons">&#xe8b8;</i></a>
    <a href="#tab3" class="mdui-ripple" onmousedown="mOver3(this)">
      <i id="tab3_icon" class="mdui-icon material-icons">&#xe616;</i>
    </a>
    <a href="#tab4" class="mdui-ripple" onmousedown="mOver4(this)">
      <i id="tab4_icon" class="mdui-icon material-icons">&#xe000;</i>
    </a>
  </div>
  <div style="height: 200px;"
    class="mdui-valign mdui-hoverable mdui-ripple mdui-shadow-1 mdui-m-a-2 mdui-color-theme mdui-img-rounded">
      <p class="mdui-center">
        <label for="file" class="uploadeal">Choose file to upload</label>
        <input id="the-file" name="file" type="file" accept=".txt,.csv" />
        <button onclick="sub()" class="uploadeal">Upload and deal</button>
        <button onclick="deal()" style="display: none;">deal</button>
      </p>
      <p id="response"></p>
  <!-- input file change English -->
  <a href="./downloads.html"><button>downloads</button></a>
  </div>
</body>
<script>
  var fileinput = document.getElementById("the-file");
  var array;
  var binaryString;
  fileinput.addEventListener(
    "change",
    function () {
      var reader = new FileReader();
      reader.onload = function () {
        var arrayBuffer = this.result,
          array = new Uint8Array(arrayBuffer);
        window.uploadFile = array;
      };
      window.fileMeta = {
        name: this.files[0].name,
        type: this.files[0].type
      };
      console.log(this.files[0])
      reader.readAsArrayBuffer(this.files[0]);
    },
    false
  );
</script>
<style>
  #uploadtext {
    text-align: center;
  }
</style>

</html>